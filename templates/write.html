{% extends "layout.html" %}

{% block content %}
<div class="fire-starter">
    <h1 class="logo">å¤œç„šãç«
        <span style="display: block; font-size: 0.5em; letter-spacing: 0.2em; opacity: 0.8; margin-top: 0.2rem;">
            - Yotakibi -
        </span>
    </h1>
    <p class="intro">
        ã‚ãªãŸã®è¨€è‘‰ã‚’è–ªã¨ã—ã¦ç„šã¹ã‚‹ã¨ã€<br>
        èª°ã‹ãŒç¯ã—ãŸç«ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
    </p>
    <div class="guide-nav">
        <a href="{{ url_for('manual', source='write') }}" class="guide-link">
            å¤œç„šãç«ã®æ­©ãæ–¹
        </a>
    </div>

    <style>
        .guide-nav {
            text-align: center;
            /* ä¸Šã®ä½™ç™½ã¯ç¶­æŒã—ã¤ã¤ã€ä¸‹ã®ä½™ç™½ã‚’ 2.5rem -> 1rem ã«è©°ã‚ã¾ã—ãŸ */
            margin: 1.5rem 0 1rem 0;
        }

        .guide-link {
            display: inline-block;
            /* æ–‡å­—è‰²ã‚’æ˜ã‚‹ã„å°éº¦è‰²ã«å¤‰æ›´ */
            color: #F5DEB3;
            /* èƒŒæ™¯ã‚’å°‘ã—æ˜ã‚‹ã„ç„¦ã’èŒ¶è‰²ã« */
            background: #2C241B;
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            /* æ ç·šã‚’æœ€åˆã‹ã‚‰ã¯ã£ãã‚Šè¡¨ç¤º */
            border: 1px solid #8B4513;
            font-size: 0.95rem;
            text-decoration: none;
            transition: all 0.3s ease;
            /* å½±ã‚’ã¤ã‘ã¦å°‘ã—æµ®ãä¸ŠãŒã‚‰ã›ã‚‹ */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .guide-link:hover {
            background: #3E3226;
            border-color: #D4AF37;
            /* ãƒ›ãƒãƒ¼æ™‚ã«æ ãŒé‡‘ã« */
            color: #FFF;
            /* ãƒ›ãƒãƒ¼æ™‚ã«æ–‡å­—ã‚’ç™½ã */
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            transform: translateY(-2px);
            /* å°‘ã—ã ã‘ãµã‚ã£ã¨æµ®ã */
        }
    </style>

    <form action="{{ url_for('write') }}" method="POST" class="diary-form" novalidate>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="form-group">
            <label for="content">è–ªï¼ˆä»Šæ—¥ã®è¨€è‘‰ï¼‰</label>
            <textarea name="content" id="content" rows="6" placeholder="ç‹¬ã‚Šã®å¤œã‚‚æ‚ªããªã„ã€‚"
                required>{{ kept_content if kept_content else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="aikotoba">ç¨®ç«</label>

            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <input type="text" name="aikotoba" id="aikotoba" placeholder="ãã‚‡ã†ã®ãŸã­ã³" required autocomplete="off"
                    style="flex: 1;">

                <button type="button" onclick="generateRandomKey()"
                    style="background: none; border: 1px solid #5C4A3D; color: #D4AF37; padding: 0.5rem 1rem; cursor: pointer; border-radius: 4px; font-size: 0.9rem;">
                    ğŸ² ç”Ÿæˆ
                </button>
            </div>

            <span class="hint">
                ç¨®ç«ï¼ˆåˆè¨€è‘‰ï¼‰ã‚’æ±ºã‚ã¾ã—ã‚‡ã†ã€‚<br>
                ã€Œã­ã“ã€ã€Œç©ºã€ã®ã‚ˆã†ãªç°¡å˜ãªè¨€è‘‰ã¯ã€å¶ç„¶èª°ã‹ã¨é‡ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>
                è‡ªåˆ†ã ã‘ã®ç§˜å¯†ã«ã—ãŸã„å ´åˆã¯ã€<strong>ç”Ÿæˆãƒœã‚¿ãƒ³</strong>ã‚’æŠ¼ã—ã¦ã€ã‚ãªãŸã ã‘ã®ç‰¹åˆ¥ãªç«ã‚’ä½œã£ã¦ãã ã•ã„ã€‚
            </span>

            {# --- å¤‰æ›´ç®‡æ‰€ï¼šå…¬é–‹è¨­å®šãƒ‘ãƒãƒ« --- #}
            <div class="form-group"
                style="margin-top: 1.5rem; background: rgba(62, 50, 40, 0.3); padding: 1rem; border-radius: 4px;">
                <label
                    style="margin-bottom: 0.8rem; border-bottom: 1px dashed #5C4A3D; padding-bottom: 0.5rem; width: 100%; color: #D4AF37;">
                    å…¬é–‹è¨­å®š
                </label>

                <div class="checkbox-group">
                    <input type="checkbox" name="is_public" id="is_public" value="1" checked>
                    <label for="is_public" class="checkbox-label">
                        ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«è–ªã‚’ãã¹ã‚‹ï¼ˆæ²è¼‰ã™ã‚‹ï¼‰
                    </label>
                </div>
                <p class="hint" style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã¨ã€æ¤œç´¢ï¼ˆç¨®ç«ã‚’çŸ¥ã£ã¦ã„ã‚‹äººï¼‰ä»¥å¤–ã‹ã‚‰ã¯è¦‹ãˆãªããªã‚Šã¾ã™ã€‚
                </p>

                <div class="checkbox-group">
                    <input type="checkbox" name="show_aikotoba" id="show_aikotoba" value="1">
                    <label for="show_aikotoba" class="checkbox-label">
                        ç¨®ç«ï¼ˆåˆè¨€è‘‰ï¼‰ã®åå‰ã‚’è¡¨ç¤ºã™ã‚‹
                    </label>
                </div>
                <p class="hint" style="margin-left: 1.5rem;">
                    ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã‚‹ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«ç¨®ç«ãŒå…¬é–‹ã•ã‚Œã¾ã™ã€‚<br>
                    é€£è¼‰ã‚’ã—ãŸã„æ™‚ã‚„ã€ç¶™ç¶šçš„ã«è¦‹ã¦ã‚‚ã‚‰ã„ãŸã„ã¨ãã«ã”åˆ©ç”¨ãã ã•ã„ã€‚<br>
                </p>
            </div>
            {# --- å¤‰æ›´ç®‡æ‰€ã“ã“ã¾ã§ --- #}

            {# --- ç®¡ç†è€…ç”¨ï¼šæ™‚ã®èª¿æ•´ãƒ‘ãƒãƒ« --- #}
            {% if session.get('is_admin') %}
            <div class="admin-time-control">
                <label for="custom_time" class="time-label">ğŸ•°ï¸ æ™‚ã®èª¿æ•´ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰</label>
                <input type="datetime-local" name="custom_time" id="custom_time" class="time-input">
                <span class="hint" style="margin-top: 0.2rem;">
                    æŒ‡å®šã—ãªã„å ´åˆã¯ã€é€šå¸¸é€šã‚Šãƒ©ãƒ³ãƒ€ãƒ ãªéå»ã®å¤œã«ãªã‚Šã¾ã™ã€‚
                </span>
            </div>

            <style>
                .admin-time-control {
                    margin-top: 1.5rem;
                    padding: 1rem;
                    border: 1px dashed #D4AF37;
                    /* ç¥ç€è‰²ã®ç ´ç·š */
                    border-radius: 4px;
                    background-color: rgba(62, 50, 40, 0.3);
                }

                .time-label {
                    color: #D4AF37;
                    font-size: 0.9rem;
                    margin-bottom: 0.5rem;
                    display: block;
                }

                .time-input {
                    background-color: #2C241B;
                    border: 1px solid #5C4A3D;
                    color: #E0D6C8;
                    padding: 0.5rem;
                    border-radius: 4px;
                    font-family: inherit;
                    width: 100%;
                    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²åè»¢ */
                    color-scheme: dark;
                }

                .time-input:focus {
                    border-color: #D4AF37;
                    outline: none;
                }
            </style>
            {% endif %}
            {# --- ã“ã“ã¾ã§ --- #}

        </div>

        <button type="submit" class="btn-burn">ç«ã‚’ç„šã¹ã‚‹</button>
    </form>
    <div class="write-back-nav">
        <a href="{{ url_for('index') }}" class="write-back-link">
            &lt; ç„šãç«ã«æˆ»ã‚‹
        </a>
    </div>

    <style>
        .write-back-nav {
            margin-top: 2rem;
            text-align: center;
        }

        .write-back-link {
            display: inline-block;
            color: #E0D6C8;
            /* æ˜ã‚‹ã„æ–‡å­—è‰² */
            border: 1px solid #5C4A3D;
            /* æ ç·šã‚’ã¤ã‘ã‚‹ */
            padding: 0.6rem 2rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            /* å°‘ã—èƒŒæ™¯ã‚’æš—ãã—ã¦æ–‡å­—ã‚’æµ®ãç«‹ãŸã›ã‚‹ */
            transition: all 0.3s ease;
        }

        .write-back-link:hover {
            border-color: #D4AF37;
            /* ãƒ›ãƒãƒ¼ã§æ ã‚’é‡‘è‰²ã« */
            color: #D4AF37;
            /* æ–‡å­—ã‚‚é‡‘è‰²ã« */
            background: rgba(44, 36, 27, 0.8);
        }
    </style>
</div>

<script>
    function generateRandomKey() {
        // ãƒ©ãƒ³ãƒ€ãƒ ãªè‹±æ•°å­—10æ–‡å­—ã‚’ç”Ÿæˆ
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let result = "";
        for (let i = 0; i < 12; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }

        // å…¥åŠ›æ¬„ã«ã‚»ãƒƒãƒˆ
        const input = document.getElementById('aikotoba');
        input.value = result;

        // ç”Ÿæˆã—ãŸã“ã¨ãŒã‚ã‹ã‚‹ã‚ˆã†ã«å°‘ã—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆç‚¹æ»…ï¼‰
        input.style.backgroundColor = "#5C4A3D";
        setTimeout(() => {
            input.style.backgroundColor = "#3E3228";
        }, 200);
    }
</script>
{% endblock %}