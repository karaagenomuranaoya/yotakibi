name: Auto Fire Keeper (AI Bot)

on:
  schedule:
    # UTC時刻で指定します (JST - 9時間)
    # JST 19:00 - 25:00 (翌01:00)
    # UTC 10:00 - 16:00
    # 30分おきに実行 (例: 10:00, 10:30, ...)
  - cron: '*/15 10-16 * * *'
  
  # 手動でも実行できるようにするボタン
  workflow_dispatch:

jobs:
  ignite_fire:
    runs-on: ubuntu-latest
    steps:
      - name: Call AI Bot API
        env:
          # RenderのアプリURLを設定 (Secrets推奨だが、URL自体は公開情報なので直書きでも可)
          APP_URL: ${{ secrets.APP_URL }} 
          # 認証用の秘密鍵
          BOT_SECRET: ${{ secrets.AI_BOT_SECRET }}
        run: |
          echo "Calling AI Fire Keeper..."
          # curlでPOSTリクエストを送る
          # エラーの中身が見たいので --fail を削除し、詳細表示の -v を追加
          curl -v -X POST "${APP_URL}/api/bot/ignite" \
               -H "X-Bot-Secret: ${BOT_SECRET}" \
               -H "Content-Type: application/json"