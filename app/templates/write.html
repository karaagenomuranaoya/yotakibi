{% extends "layout.html" %}

{% block content %}
<div class="fire-starter">
    <h1 class="logo">å¤œç„šãç«
        <span style="display: block; font-size: 0.5em; letter-spacing: 0.2em; opacity: 0.8; margin-top: 0.2rem;">
            - Yotakibi -
        </span>
    </h1>
    <p class="intro">
        è¨€è‘‰ã¨ã„ã†åã®è–ªã‚’ç„šã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>
        æ—¥è¨˜ã‚„å¥½ããªã‚‚ã®ã€æ¥½ã—ã‹ã£ãŸã“ã¨ã‚„æ‚²ã—ã‹ã£ãŸã“ã¨ã€<br>
        ä»Šå¤œã¯ãªã«ã‚’ç„šã¹ã¾ã—ã‚‡ã†ã€‚
    </p>
    <div class="guide-nav">
        <a href="{{ url_for('main.manual', source='write') }}" class="guide-link">
            å¤œç„šãç«ã®æ­©ãæ–¹
        </a>
    </div>

    <style>
        .guide-nav {
            text-align: center;
            margin: 1.5rem 0 1rem 0;
        }

        .guide-link {
            display: inline-block;
            color: #F5DEB3;
            background: #2C241B;
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            border: 1px solid #8B4513;
            font-size: 0.95rem;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .guide-link:hover {
            background: #3E3226;
            border-color: #D4AF37;
            color: #FFF;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            transform: translateY(-2px);
        }
    </style>

    <form action="{{ url_for('post.write') }}" method="POST" class="diary-form" novalidate>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="form-group">
            <label for="content">è–ªï¼ˆä»Šæ—¥ã®è¨€è‘‰ï¼‰</label>
            <textarea name="content" id="content" rows="6" placeholder="ç‹¬ã‚Šã®å¤œã‚‚æ‚ªããªã„ã€‚"
                required>{{ kept_content if kept_content else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="aikotoba">ç¨®ç«</label>

            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <input type="text" name="aikotoba" id="aikotoba" placeholder="ç¨®ç«ã‚’å…¥åŠ›" required autocomplete="off"
                    style="flex: 1;">

                <button type="button" onclick="generateRandomKey()"
                    style="background: none; border: 1px solid #5C4A3D; color: #D4AF37; padding: 0.5rem 1rem; cursor: pointer; border-radius: 4px; font-size: 0.9rem;">
                    ğŸ² ç”Ÿæˆ
                </button>
            </div>

            <span class="hint">
                ç¨®ç«ï¼ˆåˆè¨€è‘‰ï¼‰ã‚’æ±ºã‚ã¾ã—ã‚‡ã†ã€‚<br>
                ã“ã‚ŒãŒã‚ã‚Œã°ã€ã‚ã¨ã§ã‚ãªãŸã®ç«ã‚’æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚<br>
                ä»–ã®äººã«æ¢ã•ã‚ŒãŸããªã„ã¨ãã¯ã€è¤‡é›‘ãªç¨®ç«ãŒã„ã„ã§ã—ã‚‡ã†ã€‚
            </span>

            <p class="hint" style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 4px;">
                â€»ãã¹ã‚‰ã‚ŒãŸè–ªã¯ã€åŒ¿åã®çŠ¶æ…‹ã§ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«é™ã‹ã«ç¯ã‚Šã¾ã™ã€‚<br>
                ç¨®ç«ï¼ˆåˆè¨€è‘‰ï¼‰ã¯èª°ã«ã‚‚å…¬é–‹ã•ã‚Œã¾ã›ã‚“ã€‚
            </p>


            {# --- ç®¡ç†è€…ç”¨ï¼šæ™‚ã®èª¿æ•´ãƒ‘ãƒãƒ« --- #}
            {% if session.get('is_admin') %}
            <div class="admin-time-control">
                <label for="custom_time" class="time-label">ğŸ•°ï¸ æ™‚ã®èª¿æ•´ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰</label>
                <input type="datetime-local" name="custom_time" id="custom_time" class="time-input">
                <span class="hint" style="margin-top: 0.2rem;">
                    æŒ‡å®šã—ãªã„å ´åˆã¯ã€é€šå¸¸é€šã‚Šç¾åœ¨æ™‚é–“ã®æŠ•ç¨¿ã«ãªã‚Šã¾ã™ã€‚
                </span>
            </div>
            <style>
                .admin-time-control {
                    margin-top: 1.5rem;
                    padding: 1rem;
                    border: 1px dashed #D4AF37;
                    border-radius: 4px;
                    background-color: rgba(62, 50, 40, 0.3);
                }

                .time-label {
                    color: #D4AF37;
                    font-size: 0.9rem;
                    margin-bottom: 0.5rem;
                    display: block;
                }

                .time-input {
                    background-color: #2C241B;
                    border: 1px solid #5C4A3D;
                    color: #E0D6C8;
                    padding: 0.5rem;
                    border-radius: 4px;
                    font-family: inherit;
                    width: 100%;
                    color-scheme: dark;
                }
            </style>
            {% endif %}

        </div>

        <button type="submit" class="btn-burn">ç«ã‚’ç„šã¹ã‚‹</button>
    </form>

    <div class="write-back-nav">
        <a href="{{ url_for('main.index') }}" class="write-back-link">
            &lt; ç„šãç«ã«æˆ»ã‚‹
        </a>
    </div>

    <style>
        .write-back-nav {
            margin-top: 2rem;
            text-align: center;
        }

        .write-back-link {
            display: inline-block;
            color: #E0D6C8;
            border: 1px solid #5C4A3D;
            padding: 0.6rem 2rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .write-back-link:hover {
            border-color: #D4AF37;
            color: #D4AF37;
            background: rgba(44, 36, 27, 0.8);
        }
    </style>
</div>

<script>
    function generateRandomKey() {
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let result = "";
        for (let i = 0; i < 12; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        const input = document.getElementById('aikotoba');
        input.value = result;
        input.style.backgroundColor = "#5C4A3D";
        setTimeout(() => {
            input.style.backgroundColor = "#3E3228";
        }, 200);
    }
</script>
{% endblock %}